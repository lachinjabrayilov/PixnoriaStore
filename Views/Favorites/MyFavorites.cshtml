@model List<PixnoriaStore.Models.Urun>

@{
    ViewBag.Title = "Favori Ürünlerim";
    Layout = null;
}

<style>
    body {
        background: #f5f5f5;
        font-family: 'Segoe UI', Arial, sans-serif;
        margin: 0;
        padding: 0;
    }

    .favorites-container {
        max-width: 1200px;
        margin: 40px auto;
        background: #fff;
        border-radius: 23px;
        box-shadow: 0 2px 22px rgba(0,0,0,0.09);
        padding: 42px 30px 40px 30px;
        min-height: 80vh;
    }

    .favorites-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
    }

    .favorites-title {
        color: #e00;
        font-size: 2em;
        font-family: 'Montserrat',Arial,sans-serif;
        font-weight: 700;
        margin: 0;
        letter-spacing: 1px;
    }

    .go-home-btn {
        display: inline-block;
        background: #e00;
        color: #fff;
        font-weight: 700;
        padding: 10px 32px;
        border-radius: 12px;
        text-decoration: none;
        box-shadow: 0 1px 8px rgba(224,0,0,0.18);
        transition: 0.17s;
        border: none;
        font-size: 1.03em;
        margin-left: 14px;
    }

        .go-home-btn:hover {
            background: #fff;
            color: #e00;
            border: 2px solid #e00;
        }

    .fav-products {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 28px;
        width: 100%;
    }

    .fav-card {
        background: #ffeaea;
        border: 1.5px solid #e00;
        border-radius: 15px;
        padding: 22px 18px;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 305px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.06);
        position: relative;
        overflow: hidden;
    }

    .fav-img {
        width: 180px;
        height: 120px;
        object-fit: contain;
        margin-bottom: 15px;
        border-radius: 10px;
        background: #eee;
        box-shadow: 0 1px 8px rgba(0,0,0,0.08);
    }

    .fav-name {
        font-size: 1.14em;
        color: #e00;
        font-weight: 700;
        margin-bottom: 6px;
        text-align: center;
    }

    .fav-price {
        color: #222;
        font-size: 1.13em;
        font-weight: 600;
        margin-bottom: 8px;
        text-align: center;
    }

    .fav-amount {
        color: #888;
        font-size: 0.99em;
        margin-bottom: 10px;
        text-align: center;
    }

    .fav-remove-btn {
        background: #fff0f0;
        color: #e00;
        border: 2px solid #e00;
        border-radius: 10px;
        padding: 8px 21px;
        font-weight: bold;
        font-size: 1em;
        margin-top: 10px;
        cursor: pointer;
        transition: 0.18s;
    }

        .fav-remove-btn:hover {
            background: #e00;
            color: #fff;
        }

    .fav-empty {
        color: #888;
        text-align: center;
        font-size: 1.14em;
        padding: 62px 0;
    }
</style>

<div class="favorites-container">
    <div class="favorites-header">
        <div class="favorites-title">Favori Ürünlerim</div>
        <a href="/" class="go-home-btn">Ana Sayfa</a>
    </div>

    @if (Model != null && Model.Count > 0)
    {
        <div class="fav-products">
            @foreach (var urun in Model)
            {
                <div class="fav-card" id="fav-@urun.Id">
                    <img src="@(string.IsNullOrEmpty(urun.ResimUrl)
                                                 ? "/images/default-product.png"
                                                 : (urun.ResimUrl.StartsWith("http") ? urun.ResimUrl : "/images/" + urun.ResimUrl))"
                 class="fav-img"
                 alt="@urun.Ad"
                 onerror="this.src='/images/default-product.png';" />
            <div class="fav-name">@urun.Ad</div>
            <div class="fav-price">@urun.Fiyat.ToString("N0") TL</div>
            <div class="fav-amount">Adet: @urun.Adet</div>
            <button type="button" class="fav-remove-btn" onclick="removeFavorite(@urun.Id)">Favoriden Çıkar</button>
        </div>
                }
        </div>
    }
    else
    {
        <div class="fav-empty">Favori ürününüz bulunmamaktadır.</div>
    }
</div>

<script>
    function removeFavorite(id) {
        fetch('/Favorites/Remove', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: id })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                var card = document.getElementById('fav-' + id);
                if (card) card.remove();
                // Eğer hiç ürün kalmadıysa boş mesajı göster:
                if (document.querySelectorAll('.fav-card').length === 0) {
                    document.querySelector('.fav-products').innerHTML = '';
                    var emptyDiv = document.createElement('div');
                    emptyDiv.className = 'fav-empty';
                    emptyDiv.textContent = 'Favori ürününüz bulunmamaktadır.';
                    document.querySelector('.favorites-container').appendChild(emptyDiv);
                }
            } else {
                alert(data.message || "Favoriden çıkılamadı!");
            }
        })
        .catch(() => alert("Favoriden çıkılırken hata!"));
    }
</script>